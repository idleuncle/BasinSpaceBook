# Deploy

## 须知

1. 部署机如具备 docker >= 1.12 环境， 请跳过docker的安装

1. 如需使用ansible安装方式，部署主控机必须具备:
    - python 2.7
    - ansible>2.4


--------

## 环境变量


   * PRIVATE\_REGISTRY:

     私有仓库的地址， 目前是 PRIVATE\_REGISTRY=10.142.55.199:5006

   * BASIN\_SPIDER\_CONFIG\_PATH

     爬虫的配置文件物理地址，位置为  
       ${部署安装包路径}/config/spider/basin-spider/config\_gpu'

     PS: 目前配置文件需要指定物理地址，未来配置文件需要改成使用环境变量的方式

   * SPIDER_API_URL

     爬虫api地址 目前是SPIDER_API_URL=10.142.55.199:5001

   * spider 配置文件内的ip 地址需要根据实际环境更换

      find ${BASIN_SPIDER_CONFIG_PATH} -name "*.json"|xargs sed -i "s/10.142.55.199/${TARGET_IP}/g"
      find ${BASIN_SPIDER_CONFIG_PATH} -name "*.toml"|xargs sed -i "s/10.142.55.199/${TARGET_IP}/g"

      TARGET_IP 需要设置成爬虫 几个服务运行所在的ip，因为目前都在一台机器上，所以都设置成一个




**手动设置的例子（以linux为例）**

bash 的环境变量设置方式为(具体要根据使用的shell)

```
echo "export PRIVATE_REGISTRY=10.142.55.199:5006" >> ~/.bashrc
```

每次更新环境变量必须 \(无法通过脚本完成，必须在终端执行source\) 

```
source ~/.bashrc
```

> 注意：环境变量的配置文件(~/.bashrc), 根据用户和终端的不同会有变化，部署人员需要事先了解服务器环境


## 安装步骤